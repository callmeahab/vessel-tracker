(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{2217:(e,t,i)=>{Promise.resolve().then(i.bind(i,9603))},9603:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>L});var s=i(5155),a=i(2115);i(3383);var r=i(7856),o=i.n(r),n=i(1733),l=i(7830);function d(e){let{vesselCount:t,onRefresh:i,onClearTrack:a,trackingVessel:r,onGenerateBufferViolations:o}=e;return(0,s.jsx)(n.P.header,{initial:{y:-20,opacity:0,rotateX:-10},animate:{y:0,opacity:1,rotateX:0},transition:{duration:.6,ease:"easeOut"},className:"relative z-10 glass-coral hover-3d perspective",style:{transformStyle:"preserve-3d"},children:(0,s.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center px-6 py-4",children:[(0,s.jsx)("h1",{className:"text-xl font-serif font-bold text-white text-shadow",children:"Blue Forest Sentinel"}),(0,s.jsx)("div",{className:"flex items-center gap-3",children:(0,s.jsxs)(n.P.div,{whileHover:{scale:1.05,rotateY:2},className:"glass-light px-3 py-1 rounded-lg text-sm text-white backdrop-blur-md hover-3d floating",children:[(0,s.jsx)(l.GGt,{className:"inline mr-1"}),(0,s.jsx)("span",{className:"font-medium mr-1 text-shadow-sm",children:"Vessels: "}),(0,s.jsx)("span",{className:"font-semibold text-shadow-3d",children:t})]})})]}),(0,s.jsx)("nav",{className:"",children:(0,s.jsx)("div",{className:"px-6 py-3",children:(0,s.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-xs font-medium text-white/70 uppercase tracking-wider text-shadow-sm",children:"Monitoring:"}),(0,s.jsxs)("button",{onClick:o,className:"px-3 py-1.5 glass-seagrass rounded-md text-white text-xs font-medium hover-3d hover:gradient-coral text-shadow-3d hover:cursor-pointer",children:[(0,s.jsx)(l.Wux,{className:"inline mr-1"})," View All Violations"]})]}),(0,s.jsx)("div",{className:"h-4 w-px bg-white/30 mx-2"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-xs font-medium text-white/70 uppercase tracking-wider text-shadow-sm",children:"Tracking:"}),r&&a&&(0,s.jsxs)("button",{onClick:a,className:"px-3 py-1.5 glass rounded-md text-white text-xs font-medium hover-3d hover:bg-white/30 text-shadow-3d hover:cursor-pointer",children:[(0,s.jsx)(l.b6i,{className:"inline mr-1"})," Clear (",r.name,")"]})]}),(0,s.jsx)("div",{className:"h-4 w-px bg-white/30 mx-2"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-xs font-medium text-white/70 uppercase tracking-wider text-shadow-sm",children:"System:"}),(0,s.jsxs)("button",{onClick:i,className:"px-3 py-1.5 glass-ocean rounded-md text-white text-xs font-medium hover-3d hover:gradient-ocean-light text-shadow-3d hover:cursor-pointer",children:[(0,s.jsx)(l.joZ,{className:"inline mr-1"})," Refresh"]})]})]})})})]})})}function c(e){let{layers:t=[],onLayerToggle:i,showToggleControls:r=!1}=e,[o,d]=(0,a.useState)(!1),c=(0,a.useCallback)((e,t)=>{null==i||i(e,!t)},[i]),u=(0,a.useCallback)(()=>{d(e=>!e)},[]);return(0,s.jsx)(n.P.div,{initial:{opacity:0,x:-20,rotateY:-15},animate:{opacity:1,x:0,rotateY:0},transition:{duration:.6,ease:"easeOut"},className:"absolute top-35 left-5 z-[1] select-none perspective",style:{transformStyle:"preserve-3d"},children:(0,s.jsx)(n.P.div,{initial:{width:50,height:50},animate:{width:o?280:50,height:o?"610px":50},transition:{type:"spring",stiffness:400,damping:30,duration:.3},className:"glass-seagrass hover-3d rounded-xl overflow-hidden cursor-pointer",onClick:o?void 0:u,children:o?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.P.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.2,delay:.1},className:"bg-white/20 border-b border-white/20 px-4 py-3 cursor-pointer flex justify-between items-center backdrop-blur-sm",onClick:u,children:[(0,s.jsxs)("div",{className:"text-sm font-serif font-semibold text-white text-shadow-sm flex items-center",children:[(0,s.jsx)(l.Cd7,{className:"mr-2"})," Map Legend"]}),(0,s.jsx)(n.P.div,{animate:{rotate:180},transition:{duration:.2},className:"text-white/70",children:(0,s.jsx)(l.j1Q,{})})]}),(0,s.jsx)(n.P.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.2,delay:.2},children:(0,s.jsx)("div",{className:"p-4 overflow-y-auto",style:{maxHeight:"610px"},children:t&&t.length>0?t.map((e,t)=>(0,s.jsxs)(n.P.div,{initial:{opacity:0,x:-10,rotateX:20},animate:{opacity:1,x:0,rotateX:0},transition:{duration:.2,delay:.25+.05*t,type:"spring",stiffness:200},className:"flex items-center mb-3 p-2 rounded-md cursor-pointer border hover-3d ".concat(e.visible?"bg-white/20 border-white/30 backdrop-blur-sm hover:bg-white/30":"bg-black/20 border-white/20 opacity-60 hover:bg-white/20"),whileHover:{scale:1.03,rotateY:2,rotateX:-1},whileTap:{scale:.97,rotateY:-1},onClick:()=>r?c(e.id,e.visible):null,children:[r&&(0,s.jsx)("div",{className:"mr-3 flex items-center justify-center",children:e.visible?(0,s.jsx)(l.lEn,{className:"text-lg",style:{color:e.color}}):(0,s.jsx)(l.Dnq,{className:"text-lg text-white/40"})}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center mb-1",children:[(0,s.jsx)("span",{className:"text-sm mr-2",children:e.icon}),(0,s.jsx)("span",{className:"text-white text-sm font-medium text-shadow-sm",children:e.name})]}),(0,s.jsx)("div",{className:"text-white/80 text-xs leading-relaxed",children:e.description})]}),(0,s.jsx)("div",{className:"w-4 h-4 rounded-full border-2 border-white/50 ml-2 flex-shrink-0 shadow-sm",style:{backgroundColor:e.color}})]},e.id)):(0,s.jsx)("div",{className:"p-2 text-white/70 text-xs",children:"No layers available"})})})]}):(0,s.jsx)(n.P.div,{initial:{opacity:0,rotateZ:-45},animate:{opacity:1,rotateZ:0},transition:{duration:.4,delay:.1,type:"spring"},className:"w-full h-full flex items-center justify-center hover-3d floating",whileHover:{scale:1.15,rotateY:10,rotateX:5},whileTap:{scale:.9,rotateY:-5},children:(0,s.jsx)("div",{className:"text-lg text-white text-shadow-3d",children:(0,s.jsx)(l.Cd7,{})})})})})}var u=i(1424),p=i(9871),h=i(9091),m=i(4833),f=i(9240);class g{static closeVesselPopup(){this.currentPopup&&(this.currentPopup.remove(),this.currentPopup=void 0)}static createVesselPopup(e,t,i){let s=this.generateVesselPopupHTML(i);this.closeVesselPopup();let a=new(o()).Popup({closeButton:!0,closeOnClick:!1,className:"glassmorphic-popup"}).setLngLat(t).setHTML(s).addTo(e);return this.currentPopup=a,a.on("close",()=>{this.currentPopup===a&&(this.currentPopup=void 0)}),a}static createPosidoniaPopup(e,t,i){let s=this.generatePosidoniaPopupHTML(i);this.closeVesselPopup();let a=new(o()).Popup({closeButton:!0,closeOnClick:!1,className:"glassmorphic-popup"}).setLngLat(t).setHTML(s).addTo(e);return this.currentPopup=a,a.on("close",()=>{this.currentPopup===a&&(this.currentPopup=void 0)}),a}static generateVesselPopupHTML(e){return"\n      <div style=\"\n        width: 280px;\n        max-width: 90vw;\n        font-family: 'Inter', system-ui, -apple-system, sans-serif;\n        backdrop-filter: blur(20px);\n        -webkit-backdrop-filter: blur(20px);\n        background: linear-gradient(135deg, rgba(255, 255, 255, 0.35), rgba(255, 255, 255, 0.25), rgba(255, 255, 255, 0.2));\n        border-radius: 16px;\n        overflow: hidden;\n        box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);\n        border: 1px solid rgba(255, 255, 255, 0.3);\n      \">\n        ".concat(this.generateVesselPopupHeader(e),"\n        ").concat(this.generateVesselPopupBody(e),"\n      </div>\n    ")}static generatePosidoniaPopupHTML(e){return"\n      <div style=\"\n        width: 280px;\n        max-width: 90vw;\n        font-family: 'Inter', system-ui, -apple-system, sans-serif;\n        backdrop-filter: blur(20px);\n        -webkit-backdrop-filter: blur(20px);\n        background: linear-gradient(135deg, rgba(255, 255, 255, 0.35), rgba(255, 255, 255, 0.25), rgba(255, 255, 255, 0.2));\n        border-radius: 16px;\n        overflow: hidden;\n        box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);\n        border: 1px solid rgba(255, 255, 255, 0.3);\n      \">\n        ".concat(this.generatePosidoniaPopupHeader(e),"\n        ").concat(this.generatePosidoniaPopupBody(e),"\n      </div>\n    ")}static generateVesselPopupHeader(e){return'\n      <div style="\n        background: linear-gradient(135deg, '.concat(e.isInPark?"rgba(245, 158, 11, 0.8), rgba(234, 88, 12, 0.7), rgba(194, 65, 12, 0.6)":"rgba(14, 165, 233, 0.8), rgba(3, 105, 161, 0.7), rgba(30, 58, 138, 0.6)",');\n        color: rgba(0, 0, 0, 0.9);\n        padding: 12px 16px;\n        border-bottom: 1px solid rgba(255, 255, 255, 0.2);\n        backdrop-filter: blur(8px);\n        -webkit-backdrop-filter: blur(8px);\n      ">\n        <div style="\n          font-family: \'Merriweather\', Georgia, serif;\n          font-size: 16px;\n          font-weight: 700;\n          margin-bottom: 4px;\n          line-height: 1.2;\n          letter-spacing: 0.03em;\n          text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);\n        ">').concat(e.name||"Unknown Vessel","</div>\n        <div style=\"\n          font-family: 'Merriweather', Georgia, serif;\n          font-size: 10px;\n          opacity: 0.9;\n          text-transform: uppercase;\n          font-weight: 600;\n          letter-spacing: 0.5px;\n          text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);\n        \">").concat(e.isInPark?"\uD83D\uDEA8 INSIDE PARK":"\uD83D\uDCCD NEARBY","</div>\n      </div>\n    ")}static generatePosidoniaPopupHeader(e){let t=e.classification||"standard";e.condition;let i=this.getPosidoniaHeaderConfig(t);return'\n      <div style="\n        background: linear-gradient(135deg, '.concat(i.gradient,');\n        color: rgba(0, 0, 0, 0.9);\n        padding: 12px 16px;\n        border-bottom: 1px solid rgba(255, 255, 255, 0.2);\n        backdrop-filter: blur(8px);\n        -webkit-backdrop-filter: blur(8px);\n      ">\n        <div style="\n          font-family: \'Merriweather\', Georgia, serif;\n          font-size: 16px;\n          font-weight: 700;\n          margin-bottom: 4px;\n          line-height: 1.2;\n          letter-spacing: 0.03em;\n          text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);\n        ">').concat(i.icon," ").concat(i.title,"</div>\n        <div style=\"\n          font-family: 'Merriweather', Georgia, serif;\n          font-size: 10px;\n          opacity: 0.9;\n          text-transform: uppercase;\n          font-weight: 600;\n          letter-spacing: 0.5px;\n          text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);\n        \">").concat(i.subtitle,"</div>\n      </div>\n    ")}static getPosidoniaHeaderConfig(e){switch(e){case"healthy":return{icon:"●",title:"Healthy Posidonia",subtitle:"\uD83C\uDF0A THRIVING SEAGRASS",gradient:"rgba(16, 185, 129, 0.8), rgba(5, 150, 105, 0.7), rgba(4, 120, 87, 0.6)"};case"degraded":return{icon:"⚠",title:"Degraded Posidonia",subtitle:"\uD83D\uDEA8 DAMAGED SEAGRASS",gradient:"rgba(245, 158, 11, 0.8), rgba(234, 88, 12, 0.7), rgba(194, 65, 12, 0.6)"};case"dead":return{icon:"\uD83D\uDC80",title:"Dead Matte",subtitle:"\uD83E\uDEA6 FORMER SEAGRASS BED",gradient:"rgba(139, 69, 19, 0.8), rgba(101, 67, 33, 0.9)"};default:return{icon:"●",title:"Posidonia Beds",subtitle:"\uD83C\uDF0A PROTECTED SEAGRASS",gradient:"rgba(125, 211, 252, 0.8), rgba(14, 165, 233, 0.7), rgba(3, 105, 161, 0.6)"}}}static generatePosidoniaPopupBody(e){let t=e.classification||"standard",i=e.condition||"unknown",s=e.substrate||"unknown";return'\n      <div style="padding: 14px 16px;">\n        <div style="display: grid; gap: 8px;">\n          '.concat(this.createDetailField("Type:","Posidonia oceanica","normal","#00CED1"),"\n          ").concat(this.createDetailField("Classification:",this.formatClassification(t),"normal",this.getClassificationColor(t)),"\n          ").concat("unknown"!==i?this.createDetailField("Condition:",this.formatCondition(i),"normal",this.getConditionColor(i)):"","\n          ").concat("unknown"!==s?this.createDetailField("Substrate:",this.formatSubstrate(s),"normal","#8B9DC3"):"","\n          ").concat(e.description?this.createDetailField("Details:",this.parsePosidoniaDescription(e.description),"normal",void 0,"200px"):"","\n          ").concat(this.createDetailField("⚠ Warning:","Anchoring prohibited","normal","#ef4444"),"\n          ").concat(this.generateClassificationInfo(t),"\n        </div>\n      </div>\n    ")}static formatClassification(e){switch(e){case"healthy":return"Healthy Ecosystem";case"degraded":return"Degraded/Damaged";case"dead":return"Dead Matte";case"standard":return"Protected Area";default:return"Unknown"}}static formatCondition(e){switch(e){case"on_matte":return"On Natural Matte";case"degraded":return"Degraded State";case"dead_matte":return"Dead Matte";default:return e.charAt(0).toUpperCase()+e.slice(1)}}static formatSubstrate(e){switch(e){case"sand":return"Sandy Bottom";case"rock":return"Rocky Bottom";case"matte":return"Posidonia Matte";default:return e.charAt(0).toUpperCase()+e.slice(1)}}static getClassificationColor(e){switch(e){case"healthy":return"#00CED1";case"degraded":return"#FF6B6B";case"dead":return"#8B4513";default:return"#20B2AA"}}static getConditionColor(e){switch(e){case"on_matte":return"#059669";case"degraded":return"#f59e0b";case"dead_matte":return"#dc2626";default:return"#6b7280"}}static generateClassificationInfo(e){let t=this.getClassificationInfoConfig(e);return'\n      <div style="\n        margin-top: 12px;\n        padding: 12px;\n        background: '.concat(t.background,";\n        border-radius: 8px;\n        border-left: 4px solid ").concat(t.borderColor,';\n      ">\n        <div style="\n          font-family: \'Inter\', system-ui, sans-serif;\n          font-size: 12px;\n          color: rgba(0, 0, 0, 0.8);\n          line-height: 1.4;\n        ">\n          <strong>').concat(t.title,":</strong><br>\n          ").concat(t.description,"\n        </div>\n      </div>\n    ")}static getClassificationInfoConfig(e){switch(e){case"healthy":return{title:"Healthy Ecosystem",description:"These thriving seagrass beds provide essential marine habitat, produce oxygen, and support biodiversity. Critical for marine ecosystem health.",background:"linear-gradient(135deg, rgba(16, 185, 129, 0.15), rgba(5, 150, 105, 0.1))",borderColor:"#00CED1"};case"degraded":return{title:"Degraded Habitat",description:"This area shows signs of posidonia degradation, possibly from anchoring, pollution, or environmental stress. Recovery is slow and requires protection.",background:"linear-gradient(135deg, rgba(245, 158, 11, 0.15), rgba(234, 88, 12, 0.1))",borderColor:"#FF6B6B"};case"dead":return{title:"Former Seagrass Bed",description:"This area contains dead posidonia matte - the remnants of former seagrass beds. While no longer living, it still provides some habitat structure.",background:"linear-gradient(135deg, rgba(139, 69, 19, 0.15), rgba(101, 67, 33, 0.1))",borderColor:"#8B4513"};default:return{title:"Environmental Protection",description:"These seagrass beds are vital marine ecosystems that provide oxygen, food, and shelter for marine life. Anchoring damages these slow-growing plants.",background:"linear-gradient(135deg, rgba(125, 211, 252, 0.15), rgba(14, 165, 233, 0.1))",borderColor:"#20B2AA"}}}static parsePosidoniaDescription(e){let t=e.replace(/<[^>]*>/g,"").replace(/&[^;]+;/g," "),i=t.match(/Superficie:\s*([0-9.]+)/i),s=t.match(/Posidonia\s+([^<\n]+)/i),a="";return i&&(a+="Area: ".concat(i[1]," m\xb2")),s&&(a&&(a+=" • "),a+=s[1].trim()),a||"Marine protected area"}static generateVesselPopupBody(e){let t=this.buildDetailFields(e);return'\n      <div style="padding: 14px 16px;">\n        <div style="display: grid; gap: 8px;">\n          '.concat(t.join(""),"\n          ").concat(this.generateTimestamp(e.timestamp),"\n        </div>\n      </div>\n    ")}static buildDetailFields(e){let t=[],i=e.type||"Unknown",s=e.typeSpecific?" (".concat(e.typeSpecific,")"):"";if(t.push(this.createDetailField("Type:","".concat(i).concat(s))),t.push(this.createDetailField("MMSI:",e.mmsi||"N/A","monospace")),e.imo&&t.push(this.createDetailField("IMO:",e.imo,"monospace")),e.countryIso&&t.push(this.createDetailField("Flag:",e.countryIso)),null!==e.speed&&void 0!==e.speed&&t.push(this.createDetailField("⚡ Speed:","".concat(e.speed," knots"),"normal","#059669")),null!==e.course&&void 0!==e.course&&t.push(this.createDetailField("↗ Course:","".concat(e.course,"\xb0"))),null!==e.heading&&void 0!==e.heading&&t.push(this.createDetailField("→ Heading:","".concat(e.heading,"\xb0"))),e.destination&&t.push(this.createDetailField("\uD83D\uDCCD Destination:",e.destination,"normal",void 0,"140px")),null!==e.distance&&void 0!==e.distance&&t.push(this.createDetailField("\uD83D\uDCD0 Distance:","".concat(e.distance.toFixed(1)," nm"),"normal","#fbbf24")),null!==e.distanceToNearestPosidonia&&void 0!==e.distanceToNearestPosidonia&&e.distanceToNearestPosidonia<500){let i=e.distanceToNearestPosidonia,s=i<50?"#ef4444":i<100?"#f59e0b":"#10b981",a=i<50?"⚠":i<100?"⚡":"●";t.push(this.createDetailField("".concat(a," Posidonia:"),"".concat(i.toFixed(0),"m away"),"normal",s))}return e.isAnchoredOnPosidonia&&t.push(this.createDetailField("⛔ Violation:","Anchored on seagrass","normal","#dc2626")),t}static createDetailField(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2];let i=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0,a="\n      color: ".concat(i||"rgba(0, 0, 0, 0.7)",";\n      ").concat("font-family: 'Inter', system-ui, sans-serif;","\n      font-size: 13px;\n      ").concat(s?"max-width: ".concat(s,"; word-break: break-word;"):"text-align: right;","\n      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);\n      ").concat(i?"font-weight: 700;":"","\n    ");return'\n      <div style="display: flex; justify-content: space-between; align-items: '.concat(s?"flex-start":"center",";\">\n        <span style=\"font-family: 'Inter', system-ui, sans-serif; font-weight: 600; color: rgba(0, 0, 0, 0.9); font-size: 13px; text-shadow: 0 1px 2px rgba(255, 255, 255, 0.5); ").concat(s?"flex-shrink: 0;":"",'">').concat(e,'</span>\n        <span style="').concat(a,'">').concat(t,"</span>\n      </div>\n    ")}static generateTimestamp(e){return e?'\n      <div style="\n        margin-top: 12px;\n        padding-top: 12px;\n        border-top: 1px solid rgba(0, 0, 0, 0.2);\n        display: flex;\n        align-items: center;\n        gap: 6px;\n      ">\n        <span style="color: rgba(0, 0, 0, 0.6); font-size: 11px;">\uD83D\uDD52</span>\n        <span style="font-family: \'Inter\', system-ui, sans-serif; color: rgba(0, 0, 0, 0.5); font-size: 11px; text-shadow: 0 1px 2px rgba(255, 255, 255, 0.3);">'.concat(new Date(e).toLocaleString(),"</span>\n      </div>\n    "):""}static setupVesselClickHandlers(e){e.on("click","vessels-circle",t=>{if(t.features&&t.features.length>0){let i=t.features[0],s=i.properties;if(!s)return;let a=i.geometry.coordinates;this.createVesselPopup(e,[a[0],a[1]],s)}}),e.on("mouseenter","vessels-circle",()=>{e.getCanvas().style.cursor="pointer"}),e.on("mouseleave","vessels-circle",()=>{e.getCanvas().style.cursor=""})}}function x(e){let{vessels:t,parkBoundaries:i,bufferedBoundaries:r,loading:o,onMapReady:l,layerVisibility:d}=e,c=(0,a.useRef)(null),x=(0,a.useRef)(!1),[y,b]=(0,a.useState)(null),[v]=(0,a.useState)({vessels:!0,"posidonia-healthy":!0,"posidonia-degraded":!0,"posidonia-dead":!0,"posidonia-standard":!0,"park-boundaries":!0,"buffer-zone":!0}),w=d||v,k=(0,a.useMemo)(()=>{var e;let t;return e=e=>{if(!c.current)return;let t=c.current.getMap();requestAnimationFrame(()=>{let i={vessels:["vessels-circle","vessels-labels"],"posidonia-healthy":["posidonia-healthy-fill","posidonia-healthy-outline"],"posidonia-degraded":["posidonia-degraded-fill","posidonia-degraded-outline"],"posidonia-dead":["posidonia-dead-fill","posidonia-dead-outline"],"posidonia-standard":["posidonia-standard-fill","posidonia-standard-outline"],"park-boundaries":["park-fill","park-outline"],"buffer-zone":["buffered-fill","buffered-outline"]};Object.entries(e).forEach(e=>{let[s,a]=e,r=i[s];r&&r.forEach(e=>{t.getLayer(e)&&t.setLayoutProperty(e,"visibility",a?"visible":"none")})})})},function(){for(var i=arguments.length,s=Array(i),a=0;a<i;a++)s[a]=arguments[a];clearTimeout(t),t=setTimeout(()=>{e(...s)},16)}},[]);(0,a.useEffect)(()=>{k(w)},[w,k]),(0,a.useEffect)(()=>{fetch("".concat("http://localhost:8080","/api/posidonia")).then(e=>{if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));return e.json()}).then(e=>{e&&"FeatureCollection"===e.type&&e.features?b(e):console.warn("Invalid posidonia GeoJSON data received:",e)}).catch(e=>console.error("Failed to load posidonia data:",e))},[]);let j=(0,a.useCallback)((e,t,s)=>{let a={isOverPosidonia:!1,posidoniaFeature:null,distanceToNearestPosidonia:1/0,isInBufferZone:!1,isInPark:!1};try{let o=p.zx([t,e]);if(i&&i.features){for(let e of i.features)if(e.geometry&&("Polygon"===e.geometry.type||"MultiPolygon"===e.geometry.type))try{if(h.m(o,e)){a.isInPark=!0;break}}catch(e){console.debug("Park boundary check failed for feature:",e)}}if(r&&r.features&&!a.isInPark){for(let e of r.features)if(e.geometry&&("Polygon"===e.geometry.type||"MultiPolygon"===e.geometry.type))try{if(h.m(o,e)){a.isInBufferZone=!0;break}}catch(e){console.debug("Buffer boundary check failed for feature:",e)}}if(y&&y.features){for(let e of y.features)if("Polygon"===e.geometry.type){let t=p.n1(e.geometry.coordinates);if(h.m(o,t)&&null!==s&&s<=.5){a.isOverPosidonia=!0,a.posidoniaFeature=e,a.distanceToNearestPosidonia=0;break}try{let e=m.I(o,f.N(t),{units:"meters"});e<a.distanceToNearestPosidonia&&(a.distanceToNearestPosidonia=e)}catch(e){console.debug("Distance calculation failed for feature:",e)}}}}catch(e){console.warn("Error in spatial analysis:",e)}return a},[y,i,r]),N=(0,a.useMemo)(()=>Array.isArray(t)&&0!==t.length?{type:"FeatureCollection",features:t.map(e=>{var t;let i=j(e.latitude,e.longitude,null!=(t=e.vessel.speed)?t:null);return{type:"Feature",geometry:{type:"Point",coordinates:[e.longitude,e.latitude]},properties:{name:e.vessel.name,isInPark:i.isInPark,isInBufferZone:i.isInBufferZone,isAnchoredOnPosidonia:i.isOverPosidonia,distanceToNearestPosidonia:i.distanceToNearestPosidonia,isNearPosidonia:i.distanceToNearestPosidonia<100,mmsi:e.vessel.mmsi,type:e.vessel.type,typeSpecific:e.vessel.type_specific,countryIso:e.vessel.country_iso,imo:e.vessel.imo,speed:e.vessel.speed,course:e.vessel.course,heading:e.vessel.heading,destination:e.vessel.destination,distance:e.vessel.distance,timestamp:e.timestamp}}})}:{type:"FeatureCollection",features:[]},[t,j]),P=(0,a.useCallback)(()=>{if(x.current)return void console.log("Map already loaded, skipping duplicate call");x.current=!0,console.log("Map loaded successfully"),l&&c.current&&l(c.current.getMap()),setTimeout(()=>{if(c.current){let e=c.current.getMap();setTimeout(()=>{["vessels-circle","vessels-icons","vessels-labels"].forEach(t=>{if(e.getLayer(t))try{e.moveLayer(t)}catch(e){console.debug("Failed to move layer ".concat(t," to top:"),e)}})},50),Object.entries(w).forEach(t=>{let[i,s]=t;switch(i){case"vessels":["vessels-circle","vessels-labels"].forEach(t=>{e.getLayer(t)&&e.setLayoutProperty(t,"visibility",s?"visible":"none")});break;case"posidonia-healthy":["posidonia-healthy-fill","posidonia-healthy-outline"].forEach(t=>{e.getLayer(t)&&e.setLayoutProperty(t,"visibility",s?"visible":"none")});break;case"posidonia-degraded":["posidonia-degraded-fill","posidonia-degraded-outline"].forEach(t=>{e.getLayer(t)&&e.setLayoutProperty(t,"visibility",s?"visible":"none")});break;case"posidonia-dead":["posidonia-dead-fill","posidonia-dead-outline"].forEach(t=>{e.getLayer(t)&&e.setLayoutProperty(t,"visibility",s?"visible":"none")});break;case"posidonia-standard":["posidonia-standard-fill","posidonia-standard-outline"].forEach(t=>{e.getLayer(t)&&e.setLayoutProperty(t,"visibility",s?"visible":"none")});break;case"park-boundaries":["park-fill","park-outline"].forEach(t=>{e.getLayer(t)&&e.setLayoutProperty(t,"visibility",s?"visible":"none")});break;case"buffer-zone":["buffered-fill","buffered-outline"].forEach(t=>{e.getLayer(t)&&e.setLayoutProperty(t,"visibility",s?"visible":"none")})}})}},500)},[l,w]),S=(0,a.useCallback)(e=>{let t=e.target.queryRenderedFeatures(e.point,{layers:["vessels-circle","vessels-icons"]});if(t&&t.length>0){let e=t[0],i=e.properties;if(!i)return;let s=e.geometry.coordinates;g.createVesselPopup(c.current.getMap(),[s[0],s[1]],i);return}let i=e.target.queryRenderedFeatures(e.point,{layers:["posidonia-healthy-fill","posidonia-degraded-fill","posidonia-dead-fill","posidonia-standard-fill"]});if(i&&i.length>0){let e=i[0],t=e.properties;if(!t)return;let s=C(e.geometry.coordinates[0]);g.createPosidoniaPopup(c.current.getMap(),s,t);return}g.closeVesselPopup()},[]),C=e=>{let t=0,i=0,s=e.length;for(let s of e)i+=s[0],t+=s[1];return[i/s,t/s]},L=(0,a.useCallback)(e=>{let t=e.target.queryRenderedFeatures(e.point,{layers:["vessels-circle","vessels-icons"]}),i=e.target.queryRenderedFeatures(e.point,{layers:["posidonia-healthy-fill","posidonia-degraded-fill","posidonia-dead-fill","posidonia-standard-fill"]});t&&t.length>0||i&&i.length>0?e.target.getCanvas().style.cursor="pointer":e.target.getCanvas().style.cursor=""},[]);return(0,s.jsxs)("div",{className:"map-container",children:[(0,s.jsx)(n.P.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.5},className:"map",children:(0,s.jsxs)(u.Ay,{ref:c,mapboxAccessToken:"pk.eyJ1IjoiY2FsbG1lYWhhYiIsImEiOiJjamlxNHJtaGoxNDBnM3FudzR5dDY5aWFtIn0.hq8FE2soHGLnmgUmU-89tg",initialViewState:{longitude:9.4167,latitude:41.2167,zoom:10,pitch:45,bearing:-17.6},projection:"globe",style:{width:"100%",height:"100%"},mapStyle:"mapbox://styles/mapbox/satellite-streets-v12",onLoad:e=>{let t=e.target;t.setProjection("globe");let i=()=>{try{if(t.hasImage("boat-icon"))return void console.log("boat-icon already exists, skipping creation");let e=document.createElement("canvas");e.width=32,e.height=32;let i=e.getContext("2d");i.clearRect(0,0,32,32),i.fillStyle="#ffffff",i.strokeStyle="#000000",i.lineWidth=2,i.beginPath(),i.ellipse(16,22.4,9.6,4.8,0,0,2*Math.PI),i.fill(),i.stroke(),i.beginPath(),i.moveTo(16,17.6),i.lineTo(16,6.4),i.stroke(),i.fillStyle="#ffffff",i.beginPath(),i.moveTo(16,6.4),i.lineTo(24,12.8),i.lineTo(16,17.6),i.closePath(),i.fill(),i.stroke();let s=i.getImageData(0,0,32,32);t.addImage("boat-icon",s),console.log("boat-icon created successfully")}catch(e){console.error("Failed to create boat-icon:",e)}};t.on("styleimagemissing",e=>{console.log("Missing image:",e.id),"boat-icon"===e.id&&(console.log("Attempting to recreate boat-icon"),i())}),t.on("style.load",()=>{var e,s;console.log("Map style loaded, creating boat icon"),i(),P(),t.getLayer("sky")||t.addLayer({id:"sky",type:"sky",paint:{"sky-type":"atmosphere","sky-atmosphere-sun":[0,90],"sky-atmosphere-sun-intensity":15,"sky-atmosphere-color":"rgba(135, 206, 235, 0.5)","sky-atmosphere-halo-color":"rgba(255, 255, 255, 0.5)"}}),t.addSource("mapbox-dem",{type:"raster-dem",url:"mapbox://mapbox.mapbox-terrain-dem-v1",tileSize:512,maxzoom:14}),t.setTerrain({source:"mapbox-dem",exaggeration:1.5});let a=null==(e=t.getStyle())?void 0:e.layers;if(a){let e=null==(s=a.find(e=>{var t;return"symbol"===e.type&&(null==(t=e.layout)?void 0:t["text-field"])}))?void 0:s.id;e&&t.addLayer({id:"3d-buildings",source:"composite","source-layer":"building",filter:["==","extrude","true"],type:"fill-extrusion",minzoom:15,paint:{"fill-extrusion-color":["interpolate",["linear"],["get","height"],0,"rgba(125, 211, 252, 0.6)",50,"rgba(14, 165, 233, 0.6)",100,"rgba(3, 105, 161, 0.6)"],"fill-extrusion-height":["interpolate",["linear"],["zoom"],15,0,15.05,["get","height"]],"fill-extrusion-base":["interpolate",["linear"],["zoom"],15,0,15.05,["get","min_height"]],"fill-extrusion-opacity":.8,"fill-extrusion-vertical-gradient":!0}},e)}}),P()},onClick:S,onMouseMove:L,children:[(0,s.jsx)(u.ov,{position:"bottom-right",showCompass:!0,showZoom:!0,visualizePitch:!0}),r&&(0,s.jsxs)(u.kL,{id:"buffered-boundaries",type:"geojson",data:r,children:[(0,s.jsx)(u.Wd,{id:"buffered-fill",type:"fill",layout:{visibility:w["buffer-zone"]?"visible":"none"},paint:{"fill-color":"#f59e0b","fill-opacity":.15}}),(0,s.jsx)(u.Wd,{id:"buffered-outline",type:"line",layout:{visibility:w["buffer-zone"]?"visible":"none"},paint:{"line-color":"#f59e0b","line-width":2,"line-dasharray":[2,2]}})]}),i&&(0,s.jsxs)(u.kL,{id:"park-boundaries",type:"geojson",data:i,children:[(0,s.jsx)(u.Wd,{id:"park-fill",type:"fill",layout:{visibility:w["park-boundaries"]?"visible":"none"},paint:{"fill-color":"#10b981","fill-opacity":.2}}),(0,s.jsx)(u.Wd,{id:"park-outline",type:"line",layout:{visibility:w["park-boundaries"]?"visible":"none"},paint:{"line-color":"#10b981","line-width":2}})]}),y&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(u.kL,{id:"posidonia-healthy-source",type:"geojson",data:{type:"FeatureCollection",features:y.features.filter(e=>{var t;return(null==(t=e.properties)?void 0:t.classification)==="healthy"})},children:[(0,s.jsx)(u.Wd,{id:"posidonia-healthy-fill",type:"fill",layout:{visibility:w["posidonia-healthy"]?"visible":"none"},paint:{"fill-color":"#10b981","fill-opacity":.7}}),(0,s.jsx)(u.Wd,{id:"posidonia-healthy-outline",type:"line",layout:{visibility:w["posidonia-healthy"]?"visible":"none"},paint:{"line-color":"#059669","line-width":2}})]}),(0,s.jsxs)(u.kL,{id:"posidonia-degraded-source",type:"geojson",data:{type:"FeatureCollection",features:y.features.filter(e=>{var t;return(null==(t=e.properties)?void 0:t.classification)==="degraded"})},children:[(0,s.jsx)(u.Wd,{id:"posidonia-degraded-fill",type:"fill",layout:{visibility:w["posidonia-degraded"]?"visible":"none"},paint:{"fill-color":"#f59e0b","fill-opacity":.6}}),(0,s.jsx)(u.Wd,{id:"posidonia-degraded-outline",type:"line",layout:{visibility:w["posidonia-degraded"]?"visible":"none"},paint:{"line-color":"#DC143C","line-width":2}})]}),(0,s.jsxs)(u.kL,{id:"posidonia-dead-source",type:"geojson",data:{type:"FeatureCollection",features:y.features.filter(e=>{var t;return(null==(t=e.properties)?void 0:t.classification)==="dead"})},children:[(0,s.jsx)(u.Wd,{id:"posidonia-dead-fill",type:"fill",layout:{visibility:w["posidonia-dead"]?"visible":"none"},paint:{"fill-color":"#059669","fill-opacity":.5}}),(0,s.jsx)(u.Wd,{id:"posidonia-dead-outline",type:"line",layout:{visibility:w["posidonia-dead"]?"visible":"none"},paint:{"line-color":"#654321","line-width":2}})]}),(0,s.jsxs)(u.kL,{id:"posidonia-standard-source",type:"geojson",data:{type:"FeatureCollection",features:y.features.filter(e=>{var t,i;return!(null==(t=e.properties)?void 0:t.classification)||(null==(i=e.properties)?void 0:i.classification)==="standard"})},children:[(0,s.jsx)(u.Wd,{id:"posidonia-standard-fill",type:"fill",layout:{visibility:w["posidonia-standard"]?"visible":"none"},paint:{"fill-color":"#7dd3fc","fill-opacity":.6}}),(0,s.jsx)(u.Wd,{id:"posidonia-standard-outline",type:"line",layout:{visibility:w["posidonia-standard"]?"visible":"none"},paint:{"line-color":"#059669","line-width":2}})]})]}),N.features.length>0&&(0,s.jsxs)(u.kL,{id:"vessels",type:"geojson",data:N,children:[(0,s.jsx)(u.Wd,{id:"vessels-circle",type:"circle",layout:{visibility:w.vessels?"visible":"none"},paint:{"circle-radius":10,"circle-color":["case",["get","isAnchoredOnPosidonia"],"#dc2626",["has","violationColor"],["get","violationColor"],["case",["get","isInPark"],"#0ea5e9",["get","isInBufferZone"],"#f59e0b","#86efac"]],"circle-stroke-color":"#ffffff","circle-stroke-width":2.5,"circle-pitch-alignment":"map","circle-pitch-scale":"map"}}),(0,s.jsx)(u.Wd,{id:"vessels-icons",type:"symbol",layout:{visibility:w.vessels?"visible":"none","icon-image":"boat-icon","icon-size":.7,"icon-allow-overlap":!0,"icon-ignore-placement":!0,"icon-rotation-alignment":"map","symbol-z-order":"source"},paint:{"icon-opacity":1,"icon-color":["case",["get","isAnchoredOnPosidonia"],"#dc2626",["has","violationSeverity"],["case",["==",["get","violationSeverity"],"critical"],"#dc2626",["==",["get","violationSeverity"],"high"],"#ef4444",["==",["get","violationSeverity"],"medium"],"#f59e0b",["==",["get","violationSeverity"],"low"],"#10b981","#86efac"],["case",["get","isInPark"],"#0ea5e9",["get","isInBufferZone"],"#f59e0b","#86efac"]]}}),(0,s.jsx)(u.Wd,{id:"vessels-labels",type:"symbol",layout:{visibility:w.vessels?"visible":"none","text-field":["get","name"],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-offset":[0,-3],"text-anchor":"bottom","text-size":13,"text-allow-overlap":!1,"symbol-z-order":"source"},paint:{"text-color":["case",["has","violationColor"],["get","violationColor"],["case",["get","isAnchoredOnPosidonia"],"#10b981",["get","isInPark"],"#059669",["get","isInBufferZone"],"#f59e0b","#7dd3fc"]],"text-halo-color":"#000000","text-halo-width":2}})]},"vessels-top-layer")]})}),o&&(0,s.jsx)(n.P.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"absolute top-4 right-4 z-20 pointer-events-none",children:(0,s.jsxs)("div",{className:"glass-heavy px-4 py-3 rounded-lg flex items-center gap-3",children:[(0,s.jsx)(n.P.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full"}),(0,s.jsx)("span",{className:"text-white text-sm font-medium text-shadow-sm",children:"Loading vessels..."})]})})]})}var y=i(1408),b=i(675),v=function(e){return e.LOW="low",e.MEDIUM="medium",e.HIGH="high",e.CRITICAL="critical",e}({});let w={bufferZoneDistance:150,shoreProximityWarning:100,speedLimitInPark:5,anchoringSpeedThreshold:.5,posidoniaProximityWarning:50};class k{detectViolations(e,t,i,s,a){let r=[],o=p.zx([e.longitude,e.latitude]),n=this.checkPosidoniaViolations(o,e.vessel.speed||0,s);r.push(...n);let l=this.checkSpeedViolation(e.vessel.speed||0,!0);l&&r.push(l);let d=this.checkBufferZoneViolation(o,i);if(d&&r.push(d),a){let e=this.checkShoreProximity(o,a);e&&r.push(e)}let c=this.getMaxSeverity(r),u=r.length>0?r.reduce((e,t)=>this.getSeverityLevel(t.severity)>this.getSeverityLevel(e.severity)?t:e):void 0;return{vessel:e,violations:r,maxSeverity:c,isWhitelisted:e.is_whitelisted||!1,primaryViolation:u}}checkBufferZoneViolation(e,t){if(!t||!t.features)return null;for(let i of t.features)if(i.geometry&&("Polygon"===i.geometry.type||"MultiPolygon"===i.geometry.type))try{let t=p.N4(i.geometry);if(h.m(e,t))return{type:"in_buffer_zone",severity:"medium",title:"Too Close to Shore",description:"Vessel is within ".concat(this.config.bufferZoneDistance,"m buffer zone - too close to protected shoreline"),icon:"shore-warning",color:"#f59e0b",distance:this.config.bufferZoneDistance,timestamp:new Date}}catch(e){console.error("Buffer zone check failed:",e)}return null}checkPosidoniaViolations(e,t,i){let s=[];if(!i||!i.features)return s;for(let a of i.features)if("Polygon"===a.geometry.type)try{let i=p.n1(a.geometry.coordinates);if(h.m(e,i)){t<=this.config.anchoringSpeedThreshold&&s.push({type:"anchored_on_posidonia",severity:"critical",title:"Anchoring on Posidonia",description:"Vessel is anchored on protected seagrass beds",icon:"anchor-ban",color:"#dc2626",actualSpeed:t,timestamp:new Date});break}}catch(e){console.debug("Posidonia check failed:",e);continue}return s}checkSpeedViolation(e,t){return e<=this.config.speedLimitInPark?null:{type:"excessive_speed",severity:"medium",title:"Speed Violation",description:"Exceeding ".concat(this.config.speedLimitInPark," knot speed limit in park"),icon:"speed",color:"#f59e0b",speedLimit:this.config.speedLimitInPark,actualSpeed:e,timestamp:new Date}}checkShoreProximity(e,t){let i=1/0;for(let s of t.features)("LineString"===s.geometry.type||"MultiLineString"===s.geometry.type)&&(i=Math.min(i,b.d(e,s,{units:"meters"})));return i<this.config.shoreProximityWarning?{type:"too_close_to_shore",severity:"high",title:"Too Close to Shore",description:"Vessel is only ".concat(Math.round(i),"m from shore"),icon:"shore-warning",color:"#ef4444",distance:Math.round(i),timestamp:new Date}:null}getMaxSeverity(e){if(0===e.length)return"low";let t=Math.max(...e.map(e=>this.getSeverityLevel(e.severity)));return this.getSeverityFromLevel(t)}getSeverityLevel(e){switch(e){case"low":return 1;case"medium":return 2;case"high":return 3;case"critical":return 4;default:return 0}}getSeverityFromLevel(e){switch(e){case 1:default:return"low";case 2:return"medium";case 3:return"high";case 4:return"critical"}}getVesselColor(e){if(0===e.violations.length)return"#86efac";switch(e.maxSeverity){case"critical":return"#dc2626";case"high":return"#ef4444";case"medium":return"#f59e0b";case"low":return"#10b981";default:return"#86efac"}}getVesselIcon(e){return e.primaryViolation?e.primaryViolation.icon:"\uD83D\uDEA2"}constructor(e={}){this.config={...w,...e}}}var j=i(2253);function N(e){let{iconName:t,className:i=""}=e;switch(t){case"shield":return(0,s.jsx)(l.Bg0,{className:i});case"speed":return(0,s.jsx)(l.BJM,{className:i});case"anchor-ban":return(0,s.jsx)(j.QNI,{className:i});case"shore-warning":return(0,s.jsx)(l.fl5,{className:i});default:return(0,s.jsx)(l.Wux,{className:i})}}function P(e){let{vessels:t,isOpen:i,onClose:r,onVesselClick:o,onTrackHistory:d}=e,c=(0,a.useMemo)(()=>{if(!i)return{critical:[],high:[],medium:[],low:[],noViolations:[],totalViolations:0};let e={critical:[],high:[],medium:[],low:[],noViolations:[],totalViolations:0};for(let i of t)if(i.violations&&i.violations.length>0){switch(i.violationSeverity){case v.CRITICAL:e.critical.push(i);break;case v.HIGH:e.high.push(i);break;case v.MEDIUM:e.medium.push(i);break;case v.LOW:e.low.push(i)}e.totalViolations++}else e.noViolations.push(i);return e},[t,i]),u=(0,a.useCallback)((e,t)=>{null==d||d(e,t)},[d]),p=(e,t)=>{let i=e.violations&&e.violations.length>0?(e=>{switch(e){case v.CRITICAL:case v.HIGH:case v.MEDIUM:case v.LOW:default:return"glass"}})(e.violationSeverity):"glass";return(0,s.jsxs)("div",{className:"".concat(i," p-4 rounded-lg cursor-pointer hover:gradient-ocean-light transition-all duration-200"),onClick:()=>null==o?void 0:o(e),children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,s.jsx)("h4",{className:"font-semibold text-base text-white truncate flex-1 mr-2 text-shadow-sm",children:e.vessel.name}),e.violations&&e.violations.length>0&&(0,s.jsxs)("span",{className:"px-2 py-0.5 rounded text-xs font-medium bg-white/20 text-white border border-white/30 backdrop-blur-sm",children:[e.violations.length," ",1===e.violations.length?"VIOLATION":"VIOLATIONS"]})]}),(0,s.jsxs)("p",{className:"text-sm text-white/90 mb-1",children:[e.vessel.type," • MMSI: ",e.vessel.mmsi]}),(0,s.jsxs)("p",{className:"text-xs text-white/70 mb-2",children:[e.latitude.toFixed(4),", ",e.longitude.toFixed(4)]}),e.violations&&e.violations.length>0&&(0,s.jsx)("div",{className:"mt-2 space-y-1",children:e.violations.map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center gap-2 text-xs text-white",children:[(0,s.jsx)(N,{iconName:e.icon,className:"text-sm"}),(0,s.jsx)("span",{className:"font-medium text-shadow-sm",children:e.title})]},t))}),e.vessel.uuid&&d&&(0,s.jsxs)("button",{onClick:t=>{t.stopPropagation(),u(e.vessel.uuid,e.vessel.name)},className:"w-full mt-3 px-3 py-2 glass-ocean rounded-md text-white text-xs font-medium hover:gradient-ocean-light transition-all duration-200 flex items-center justify-center gap-1 text-shadow-sm",children:[(0,s.jsx)(l.gwi,{className:"inline mr-1"})," Track History"]})]},"vessel-".concat(e.vessel.mmsi,"-").concat(t))};return(0,s.jsx)(y.N,{children:i&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50",onClick:r}),(0,s.jsxs)(n.P.div,{initial:{x:"100%",rotateY:15},animate:{x:0,rotateY:0},exit:{x:"100%",rotateY:15},transition:{type:"spring",stiffness:200,damping:25,duration:.4},className:"fixed top-0 right-0 w-[32rem] violations-panel-mobile h-screen glass-ocean hover-3d z-[60] flex flex-col overflow-hidden perspective",style:{transformStyle:"preserve-3d"},children:[(0,s.jsxs)("div",{className:"p-6 border-b border-white/20 bg-white/10 backdrop-blur-sm flex justify-between items-start flex-shrink-0",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("h2",{className:"font-serif font-semibold text-xl text-white mb-1 text-shadow flex items-center",children:[(0,s.jsx)(l.Wux,{className:"mr-2"})," Vessel Violations Monitor"]}),(0,s.jsx)("p",{className:"text-sm text-white/80 text-shadow-sm",children:"Real-time detection of marine violations"}),(0,s.jsxs)("div",{className:"mt-2 flex gap-2 text-xs",children:[(0,s.jsxs)("span",{className:"px-2 py-1 glass-coral rounded text-white",children:["Critical: ",c.critical.length]}),(0,s.jsxs)("span",{className:"px-2 py-1 glass-bubbles rounded text-white",children:["High: ",c.high.length]}),(0,s.jsxs)("span",{className:"px-2 py-1 glass-seagrass rounded text-white",children:["Medium: ",c.medium.length]})]})]}),(0,s.jsx)(n.P.button,{onClick:r,whileHover:{scale:1.1,rotateZ:90},whileTap:{scale:.9},className:"p-2 glass rounded-md text-white text-base font-medium hover:bg-white/30 hover-3d text-shadow-3d hover:cursor-pointer",children:(0,s.jsx)(l.m6K,{})})]}),(0,s.jsx)("div",{className:"flex-1 overflow-y-auto py-4",children:0===c.totalViolations?(0,s.jsxs)("div",{className:"px-6 py-8 text-center text-white/80",children:[(0,s.jsx)("div",{className:"text-6xl mb-4",children:(0,s.jsx)(l.mU9,{className:"text-green-400"})}),(0,s.jsx)("p",{className:"font-semibold text-lg mb-2 text-white text-shadow",children:"No violations detected"}),(0,s.jsx)("p",{className:"text-sm text-white/70",children:"All vessels are operating within regulations"})]}):(0,s.jsxs)("div",{className:"flex flex-col gap-4",children:[c.critical.length>0&&(0,s.jsxs)("div",{className:"mx-6",children:[(0,s.jsxs)("h3",{className:"font-serif font-semibold text-base text-white mb-3 pb-2 border-b border-white/20 text-shadow flex items-center",children:[(0,s.jsx)(l._Jm,{className:"mr-2 text-red-400"})," Critical Violations (",c.critical.length,")"]}),(0,s.jsx)("div",{className:"flex flex-col gap-3",children:c.critical.map((e,t)=>p(e,t))})]}),c.high.length>0&&(0,s.jsxs)("div",{className:"mx-6",children:[(0,s.jsxs)("h3",{className:"font-serif font-semibold text-base text-white mb-3 pb-2 border-b border-white/20 text-shadow flex items-center",children:[(0,s.jsx)(l.ekI,{className:"mr-2 text-orange-400"})," High Severity (",c.high.length,")"]}),(0,s.jsx)("div",{className:"flex flex-col gap-3",children:c.high.map((e,t)=>p(e,t))})]}),c.medium.length>0&&(0,s.jsxs)("div",{className:"mx-6",children:[(0,s.jsxs)("h3",{className:"font-serif font-semibold text-base text-white mb-3 pb-2 border-b border-white/20 text-shadow flex items-center",children:[(0,s.jsx)(l.Wux,{className:"mr-2 text-yellow-400"})," Medium Severity (",c.medium.length,")"]}),(0,s.jsx)("div",{className:"flex flex-col gap-3",children:c.medium.map((e,t)=>p(e,t))})]}),c.low.length>0&&(0,s.jsxs)("div",{className:"mx-6",children:[(0,s.jsxs)("h3",{className:"font-serif font-semibold text-base text-white mb-3 pb-2 border-b border-white/20 text-shadow flex items-center",children:[(0,s.jsx)(l.MJW,{className:"mr-2 text-blue-400"})," Low Severity (",c.low.length,")"]}),(0,s.jsx)("div",{className:"flex flex-col gap-3",children:c.low.map((e,t)=>p(e,t))})]}),c.noViolations.length>0&&(0,s.jsxs)("div",{className:"mx-6",children:[(0,s.jsxs)("h3",{className:"font-serif font-semibold text-base text-white mb-3 pb-2 border-b border-white/20 text-shadow flex items-center",children:[(0,s.jsx)(l.mU9,{className:"mr-2 text-green-400"})," ","Compliant Vessels (",c.noViolations.length,")"]}),(0,s.jsx)("div",{className:"flex flex-col gap-3",children:c.noViolations.map((e,t)=>p(e,t))})]})]})})]})]})})}function S(e){let{message:t="Loading...",size:i="md"}=e;return(0,s.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,s.jsxs)(n.P.div,{className:"relative ".concat({sm:"w-12 h-12",md:"w-20 h-20",lg:"w-28 h-28"}[i]),animate:{rotate:360},transition:{duration:8,repeat:1/0,ease:"linear"},children:[(0,s.jsx)("div",{className:"absolute inset-0 border-4 border-white/20 border-t-white border-r-white/40 rounded-full"}),(0,s.jsx)(n.P.div,{className:"absolute inset-2 flex items-center justify-center",animate:{rotate:-360},transition:{duration:6,repeat:1/0,ease:"linear"},children:(0,s.jsx)(n.P.div,{className:"text-white ".concat({sm:"text-lg",md:"text-2xl",lg:"text-3xl"}[i]),animate:{scale:[1,1.2,1]},transition:{duration:2,repeat:1/0},children:(0,s.jsx)(l.pOn,{})})}),(0,s.jsx)("div",{className:"absolute top-0 left-1/2 transform -translate-x-1/2 -translate-y-1 w-1 h-3 bg-white rounded-full"}),(0,s.jsx)("div",{className:"absolute bottom-0 left-1/2 transform -translate-x-1/2 translate-y-1 w-1 h-2 bg-white/60 rounded-full"}),(0,s.jsx)("div",{className:"absolute left-0 top-1/2 transform -translate-y-1/2 -translate-x-1 h-1 w-3 bg-white rounded-full"}),(0,s.jsx)("div",{className:"absolute right-0 top-1/2 transform -translate-y-1/2 translate-x-1 h-1 w-2 bg-white/60 rounded-full"})]}),(0,s.jsx)(n.P.div,{className:"flex gap-1",initial:{opacity:0},animate:{opacity:1},transition:{delay:.5},children:[void 0,void 0,void 0].map((e,t)=>(0,s.jsx)(n.P.div,{className:"w-2 h-1 bg-gradient-to-r from-blue-400 to-blue-600 rounded-full",animate:{scaleX:[1,1.5,1],opacity:[.7,1,.7]},transition:{duration:1.5,repeat:1/0,delay:.2*t}},t))}),(0,s.jsx)("p",{className:"text-white font-medium text-shadow text-center ".concat({sm:"text-sm",md:"text-base",lg:"text-lg"}[i]),children:t})]})}function C(e){let{isProcessing:t,progress:i,error:a,onClearError:r}=e;return t||a?(0,s.jsx)(y.N,{children:(0,s.jsx)(n.P.div,{initial:{opacity:0,y:20,scale:.9},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:20,scale:.9},transition:{duration:.3,ease:"easeOut"},className:"fixed bottom-24 right-4 z-50",children:(0,s.jsx)("div",{className:"glass-ocean rounded-xl px-4 py-3 shadow-xl min-w-[220px] max-w-[300px] border border-white/10",children:a?(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"text-red-400 text-sm",children:"⚠"}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("p",{className:"text-red-300 text-xs font-medium truncate",children:"Processing Error"}),(0,s.jsx)("p",{className:"text-red-200/80 text-xs truncate",title:a.message,children:a.message})]}),r&&(0,s.jsx)("button",{onClick:r,className:"text-red-200/60 hover:text-white transition-colors","aria-label":"Dismiss error",children:(0,s.jsx)(l.m6K,{className:"text-sm"})})]}):(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(n.P.div,{animate:{rotate:360},transition:{duration:3,repeat:1/0,ease:"linear"},className:"text-blue-300 flex-shrink-0",children:(0,s.jsx)(l.K6E,{className:"text-base"})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("div",{className:"mb-1.5",children:(0,s.jsx)("p",{className:"text-white/90 text-xs font-medium",children:"Analyzing Vessels"})}),i&&(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("div",{className:"w-full bg-white/10 rounded-full h-1.5 overflow-hidden",children:(0,s.jsx)(n.P.div,{className:"h-full rounded-full relative",style:{background:"linear-gradient(90deg,\n                            ".concat(i.percentage<33?"#3b82f6":i.percentage<66?"#10b981":"#22c55e"," 0%,\n                            ").concat(i.percentage<33?"#60a5fa":i.percentage<66?"#34d399":"#86efac"," 100%)")},initial:{width:0},animate:{width:"".concat(i.percentage,"%")},transition:{duration:.4,ease:"easeInOut"},children:i.percentage>5&&(0,s.jsx)(n.P.div,{className:"absolute right-0 top-0 h-full w-3 bg-white/20 rounded-full",animate:{opacity:[.3,.8,.3]},transition:{duration:1.5,repeat:1/0}})})}),(0,s.jsxs)("div",{className:"flex justify-between items-center mt-1.5",children:[(0,s.jsxs)("p",{className:"text-white/60 text-[10px]",children:[i.processed,"/",i.total," vessels"]}),(0,s.jsx)("p",{className:"text-white/70 text-[10px] font-mono",children:100===i.percentage?"Complete":"".concat(Math.round(i.processed/i.total*1e3)/10,"%")})]})]})]})]})})})}):null}function L(){let[e,t]=(0,a.useState)([]),[i,r]=(0,a.useState)(null),[n,u]=(0,a.useState)(null),[p,h]=(0,a.useState)(null),[m,f]=(0,a.useState)(!0),[g,y]=(0,a.useState)(!0),[b,w]=(0,a.useState)(null),[j,N]=(0,a.useState)(!1),[L,I]=(0,a.useState)(null),M=(0,a.useRef)(null),[T,D]=(0,a.useState)({vessels:!0,"posidonia-healthy":!0,"posidonia-degraded":!0,"posidonia-dead":!0,"posidonia-standard":!0,"park-boundaries":!0,"buffer-zone":!0}),F="http://localhost:8080";(0,a.useEffect)(()=>{(async()=>{try{console.log("Starting progressive data fetch..."),f(!0),w(null);let e=fetch("".concat(F,"/api/park-boundaries")).then(e=>e.ok?e.json():null).then(e=>{e&&(r(e),console.log("Park boundaries loaded"))}).catch(e=>console.error("Boundaries error:",e)),i=fetch("".concat(F,"/api/buffered-boundaries")).then(e=>e.ok?e.json():null).then(e=>{if(e){var t;u(e),console.log("Buffered boundaries loaded:",null==(t=e.features)?void 0:t.length,"features")}}).catch(e=>console.error("Buffered error:",e));await Promise.allSettled([e,i]),f(!1),fetch("".concat(F,"/api/vessels/in-park")).then(e=>e.ok?e.json():{vessels_in_park:[]}).then(e=>{let i=e.vessels_in_park||[];console.log("Loaded ".concat(i.length," vessels")),t(Array.isArray(i)?i:[])}).catch(e=>{console.error("Vessels error:",e),t([])})}catch(e){console.error("Critical error:",e),w("Failed to load map data. Please refresh."),f(!1)}})()},[F]),(0,a.useEffect)(()=>{(async()=>{try{let e=await fetch("".concat(F,"/api/posidonia"));if(e.ok){let t=await e.json();t&&"FeatureCollection"===t.type&&t.features&&h(t)}}catch(e){console.error("Failed to load posidonia data:",e)}})()},[F]);let V=(0,a.useMemo)(()=>new k,[]),{processViolations:_,violations:E,isProcessing:A,progress:B,error:z,clearError:O}=function(){let e=(0,a.useRef)(null),[t,i]=(0,a.useState)([]),[s,r]=(0,a.useState)(!1),[o,n]=(0,a.useState)(null),[l,d]=(0,a.useState)(null);return(0,a.useEffect)(()=>{try{e.current=new Worker("/workers/violations-worker.js"),e.current.onmessage=e=>{let{type:t,data:s}=e.data;switch(t){case"PROGRESS":n(s);break;case"VIOLATIONS_PROCESSED":i(s),n({processed:s.length,total:s.length,percentage:100}),setTimeout(()=>{r(!1),n(null)},800);break;case"ERROR":d(s),r(!1),n(null),console.error("Worker error:",s);break;default:console.warn("Unknown worker message type:",t)}},e.current.onerror=e=>{d({message:"Worker error: "+e.message,stack:e.filename+":"+e.lineno}),r(!1),n(null)}}catch(e){console.error("Failed to create worker:",e),d({message:"Failed to initialize background processor: "+e.message})}return()=>{e.current&&(e.current.terminate(),e.current=null)}},[]),{processViolations:(0,a.useCallback)((t,s,a,o,l)=>e.current?0===t.length?void i([]):void(r(!0),n({processed:0,total:t.length,percentage:0}),d(null),setTimeout(()=>{e.current&&e.current.postMessage({type:"PROCESS_VIOLATIONS",data:{vessels:t,parkBoundaries:s,bufferedBoundaries:a,posidoniaData:o,shoreline:l}})},100)):void d({message:"Worker not available. Background processing disabled."}),[]),violations:t,isProcessing:s,progress:o,error:l,clearError:(0,a.useCallback)(()=>{d(null)},[])}}(),H=(0,a.useMemo)(()=>!m&&e.length>0&&null!==i,[m,e.length,i]);(0,a.useEffect)(()=>{H&&Array.isArray(e)&&i&&_(e,i,n,p,null)},[H,e,i,n,p,_]);let W=(0,a.useMemo)(()=>E.length>0?E:H&&Array.isArray(e)?i?e.length<=10?e.map(e=>V.detectViolations(e,i,n,p,null)):[]:e.map(e=>({vessel:e,violations:[],maxSeverity:v.LOW,isWhitelisted:e.is_whitelisted||!1})):[],[E,H,e,V,i,n,p]),R=(0,a.useMemo)(()=>0===W.length?[]:W.map(e=>{let t=e.violations.some(e=>"in_buffer_zone"===e.type),i=e.violations.some(e=>"anchored_on_posidonia"===e.type),s=e.violations.some(e=>"excessive_speed"===e.type||"in_restricted_area"===e.type)||e.vessel.is_in_park||!1;return{...e.vessel,is_in_buffer_zone:t,is_in_park:s,is_anchored_on_posidonia:i,violations:e.violations||[],violationSeverity:e.maxSeverity,violationColor:e.violationColor||V.getVesselColor(e)}}),[W,V]),G=()=>{window.location.reload()},Z=(0,a.useCallback)(e=>{M.current=e,y(!1)},[]),Y=(0,a.useCallback)(e=>{M.current&&M.current.flyTo({center:[e.longitude,e.latitude],zoom:16,duration:2e3})},[]),U=(0,a.useCallback)(()=>{N(!1)},[]),q=(0,a.useCallback)(async(e,t)=>{try{I({uuid:e,name:t});let i=await fetch("".concat(F,"/api/vessels/").concat(e,"/history"));if(i.ok){let s=await i.json();if(s.history&&s.history.length>0&&M.current){let i=s.history.map(e=>[e.longitude,e.latitude]);M.current.getSource("vessel-track")&&(M.current.removeLayer("vessel-track-line"),M.current.removeLayer("vessel-track-points"),M.current.removeSource("vessel-track")),M.current.addSource("vessel-track",{type:"geojson",data:{type:"Feature",properties:{vessel_name:t,vessel_uuid:e},geometry:{type:"LineString",coordinates:i}}}),M.current.addLayer({id:"vessel-track-line",type:"line",source:"vessel-track",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#3b82f6","line-width":3,"line-opacity":.8}}),M.current.addSource("vessel-track-points",{type:"geojson",data:{type:"FeatureCollection",features:s.history.map((e,t)=>({type:"Feature",properties:{timestamp:e.timestamp,speed:e.speed,is_start:t===s.history.length-1,is_end:0===t},geometry:{type:"Point",coordinates:[e.longitude,e.latitude]}}))}}),M.current.addLayer({id:"vessel-track-points",type:"circle",source:"vessel-track-points",paint:{"circle-radius":["case",["get","is_start"],8,["get","is_end"],6,4],"circle-color":["case",["get","is_start"],"#10b981",["get","is_end"],"#ef4444","#3b82f6"],"circle-opacity":.8,"circle-stroke-width":2,"circle-stroke-color":"#ffffff"}});let a=new(o()).LngLatBounds;i.forEach(e=>a.extend(e)),M.current.fitBounds(a,{padding:50}),M.current.on("click","vessel-track-points",e=>{let i=e.features;if(i&&i.length>0){let s=i[0].properties;new(o()).Popup().setLngLat(e.lngLat).setHTML('\n                  <div style="padding: 10px; background: rgba(0, 0, 0, 0.8); border-radius: 8px; color: white;">\n                    <strong>'.concat(t,"</strong><br/>\n                    <small>Time: ").concat(new Date(null==s?void 0:s.timestamp).toLocaleString(),"</small><br/>\n                    <small>Speed: ").concat(null==s?void 0:s.speed," kts</small><br/>\n                    <small>").concat((null==s?void 0:s.is_start)?"\uD83D\uDFE2 Track Start":(null==s?void 0:s.is_end)?"\uD83D\uDD34 Latest Position":"\uD83D\uDD35 Track Point","</small>\n                  </div>\n                ")).addTo(M.current)}}),alert("Tracking history loaded for ".concat(t," (").concat(s.count," positions)"))}else alert("No tracking history found for ".concat(t)),I(null)}else alert("Failed to fetch tracking history for ".concat(t)),I(null)}catch(e){console.error("Error fetching vessel history:",e),alert("Error loading tracking history for ".concat(t)),I(null)}},[F]),J=(0,a.useCallback)(()=>{M.current&&M.current.getSource("vessel-track")&&(M.current.removeLayer("vessel-track-line"),M.current.removeLayer("vessel-track-points"),M.current.removeSource("vessel-track"),M.current.removeSource("vessel-track-points")),I(null)},[]),X=(0,a.useCallback)(()=>{N(!0)},[]),K=(0,a.useCallback)((e,t)=>{D(i=>({...i,[e]:t}))},[]),Q=(0,a.useMemo)(()=>[{id:"vessels",name:"Vessels",color:"#0ea5e9",icon:(0,s.jsx)(l.GGt,{}),description:"All tracked vessels in the area",visible:T.vessels,type:"vessels",subLayers:["vessels-circle","vessels-labels"]},{id:"posidonia-healthy",name:"Healthy Posidonia",color:"#10b981",icon:(0,s.jsx)(l.RsN,{}),description:"Thriving seagrass beds",visible:T["posidonia-healthy"],type:"posidonia"},{id:"posidonia-degraded",name:"Degraded Posidonia",color:"#f59e0b",icon:(0,s.jsx)(l.Wux,{}),description:"Damaged seagrass areas",visible:T["posidonia-degraded"],type:"posidonia"},{id:"posidonia-dead",name:"Dead Matte",color:"#059669",icon:(0,s.jsx)(l.ykz,{}),description:"Former seagrass bed remains",visible:T["posidonia-dead"],type:"posidonia"},{id:"posidonia-standard",name:"Standard Posidonia",color:"#7dd3fc",icon:(0,s.jsx)(l.FH5,{}),description:"Standard seagrass beds on rocky substrate",visible:T["posidonia-standard"],type:"posidonia",subLayers:["posidonia-standard-fill","posidonia-standard-outline"]},{id:"park-boundaries",name:"Park Boundaries",color:"#10b981",icon:(0,s.jsx)(l.uOd,{}),description:"Protected marine park area",visible:T["park-boundaries"],type:"boundaries",subLayers:["park-fill","park-outline"]},{id:"buffer-zone",name:"Buffer Zone",color:"#f59e0b",icon:(0,s.jsx)(l.Bg0,{}),description:"150m buffer around park",visible:T["buffer-zone"],type:"boundaries",subLayers:["buffered-fill","buffered-outline"]}],[T]),$=(0,a.useMemo)(()=>Array.isArray(R)?{vesselsInBuffer:R.filter(e=>e.is_in_buffer_zone&&!e.is_whitelisted).length,vesselsInPark:R.filter(e=>e.is_in_park).length}:{vesselsInBuffer:0,vesselsInPark:0},[R]);return b?(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen",style:{background:"linear-gradient(135deg, #86efac 0%, #10b981 25%, #059669 75%, #1e3a8a 100%)"},children:(0,s.jsxs)("div",{className:"text-center glass-heavy p-8 rounded-xl shadow-2xl max-w-md mx-4",children:[(0,s.jsx)("div",{className:"text-white text-6xl mb-4 drop-shadow-lg",children:"⚠️"}),(0,s.jsx)("p",{className:"text-white mb-6 font-medium text-shadow",children:b}),(0,s.jsx)("button",{onClick:G,className:"px-6 py-2 glass-ocean rounded-xl text-white font-medium transition-all duration-200 hover:bg-white/30 text-shadow-sm",children:"Retry"})]})}):(0,s.jsxs)("div",{className:"h-screen flex flex-col relative isolate",style:{background:"linear-gradient(135deg, #0ea5e9 0%, #0369a1 100%)"},children:[(m||g)&&(0,s.jsx)("div",{className:"absolute inset-0 z-50 flex items-center justify-center backdrop-blur-sm bg-black/20",children:(0,s.jsxs)("div",{className:"text-center glass-heavy p-12 rounded-2xl shadow-3xl max-w-lg mx-4",children:[(0,s.jsx)(S,{message:"Initializing Maritime Sentinel",size:"lg"}),(0,s.jsxs)("div",{className:"space-y-3 mb-6 mt-8",children:[(0,s.jsxs)("div",{className:"flex items-center justify-center space-x-2 text-white/90",children:[(0,s.jsx)("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse",style:{animationDelay:"0s"}}),(0,s.jsx)("span",{className:"text-sm font-medium text-shadow-sm",children:"Loading park boundaries..."})]}),(0,s.jsxs)("div",{className:"flex items-center justify-center space-x-2 text-white/90",children:[(0,s.jsx)("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse",style:{animationDelay:"0.5s"}}),(0,s.jsx)("span",{className:"text-sm font-medium text-shadow-sm",children:"Mapping posidonia seagrass..."})]}),(0,s.jsxs)("div",{className:"flex items-center justify-center space-x-2 text-white/90",children:[(0,s.jsx)("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse",style:{animationDelay:"1s"}}),(0,s.jsx)("span",{className:"text-sm font-medium text-shadow-sm",children:g?"Initializing map...":"Finding park rule violations..."})]})]}),(0,s.jsx)("p",{className:"text-white/80 text-sm text-shadow-sm",children:"Preparing La Maddalena National Park monitoring system"})]})}),(0,s.jsx)(C,{isProcessing:A,progress:B,error:z,onClearError:O}),(0,s.jsx)(d,{vesselCount:Array.isArray(R)?R.length:0,vesselsInBuffer:$.vesselsInBuffer,onRefresh:G,onClearTrack:J,trackingVessel:L,onGenerateBufferViolations:X}),(0,s.jsx)(x,{vessels:R,parkBoundaries:i,bufferedBoundaries:n,loading:m,onMapReady:Z,layerVisibility:T,onLayerToggle:K}),(0,s.jsx)(c,{layers:Q,onLayerToggle:K,showToggleControls:!0}),(0,s.jsx)(P,{vessels:R,isOpen:j,onClose:U,onVesselClick:Y,onTrackHistory:q})]})}}},e=>{e.O(0,[896,479,672,240,107,441,255,358],()=>e(e.s=2217)),_N_E=e.O()}]);